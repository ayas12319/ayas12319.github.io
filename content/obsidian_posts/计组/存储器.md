# 概述

## 存储器分类：
### 按存储介质分类：
易失性：半导体存储器——MOS
非易失性：
- 磁表面存储器
- 磁芯存储器
- 光盘存储器

### 按存取方式分类：
**存取时间与物理地址无关：**
- 随机存储器RAM：可读可写
- 只读存储器ROM：只读

**存取时间与物理地址有关：**
- 顺序存取：磁带
- 直接存取：磁盘

### 按在计算机中的作用分类：
#### 主存储器：
RAM：
- 静态RAM
- 动态RAM
ROM：
- MROM
- PROM
- EPROM
- EEPOM
#### 辅存：
磁带，磁盘，光盘


## 存储器的层次结构：
由上到下：
**寄存器——缓存——主存——磁盘——光盘——磁带**
【速度——>减慢； 容量——>变大； 价格/位——变低】

主要分为：
**缓存—主存层次：**
主要解决速度不匹配的问题。

**主存—辅存层次：**
主要解决容量大小的问题

# 主存储器：
## 主存中存储单元地址的分配：
CPU一次性可读取的数据长度称为字长
**寻址方式：**
- 一般采用字节编址，一个字节（8位）拥有唯一一个物理地址——称为**按字节寻址**；
- 一个地址指向字长的空间（32位，64位）——称为**按字寻址**；

## 主存的技术指标：
**1，存储容量：**
主存中存放二进制代码的总数量。
**2，存储速度：**
- **存取时间**：存储器的访问时间，读出时间和写入时间。
- **存取周期**：连续两次独立的存储器操作所需要的最小间隔时间。
**3，存储器的带宽：**
字/秒，字节/秒，位/秒

**例题解析：**
1，在异步通讯系统中，假设每秒传输150个数据帧，每帧格式包含1个起始位，7个数据位，1个奇偶校验位，2个终止位，请计算该通讯系统的**数据传输速度**？
错解：
一秒传输（1 + 7 + 1 + 2） *  150 = 11 * 150 = 1650位。故数据传输速度位：1650位/秒。
正解：（我们关心的只有7位数据位）
故为：每秒150帧 × 7数据位/帧 = 1050 位/秒

2，什么是总线带宽？假设总线的时钟频率为33MHz，且一个总线时钟周期为一个总线传输周期。若在一个总线传输周期可传送4个字节的数据，求总线带宽，并分析哪些因素影响总线的带宽。
解：
总线带宽：单位时间内总线传输的数据位数。
时钟周期T = $\frac{1}{p}$，故 = 4 / T = 4 * P = 132MBps。
影响因素：总线宽度，传输距离，数据传输形式。

3，设一个32位的微处理器配有16位的外部数据总线，时钟频率为50MHz，若总线传输的最短周期为4个时钟周期，试问处理器的最大数据传输率是多少？若想提高一倍数据传输率，可采取什么措施？
解：
1M = $10^6$.
传输周期T = 4 * t = 4 / Pin = 8 * $10^{-8}$s
单位周期内的传输位数 = 16 / 8 = 2B
故速度为：2B / T = ~~~~
即扩大一倍的时钟频率。

## 地址，数据线与存储容量的关系：
例题：
. 某存储器容量为32K×16位，则———。      
    A.  地址线16根 ，数据线32根  
     B. 地址线32根 ，数据线16根 
     C. 地址线15根 ，数据线16根 

**32k表示该存储器有32k个存储单元**，即有32 * $2^{10}$ = $2^{15}$个存储单元。
**地址线的作用：唯一地选中这$2^{15}$个存储单元中的一个。**
故需要15个地址线。
16位表示这个存储器的位宽是16位。故需要16根数据线。

# 随机存取存储器RAM：
## RAM的类型与特性
-  **SRAM（静态RAM）：**
存储原理：双稳态触发器（6个MOS管），集成度较低；
不需要刷新；
访存速度快；
成本较高，主要用于cache中。
SRAM在进行读写操作时，必须先接受**地址信号**，再接受**片选信号**和**读写信号**。
为易失性存储器，断电后数据丢失。
- **DRAM（动态RAM）：**
存储原理：电容电荷（1个MOS管+1个电容），集中度较高；
需要定期刷新；
访存速度慢；
成本较低，主要用于主存中。

**DRAM的地址线复用：**
**1，为什么DRAM采用地址线复用：**
根本目的：将地址分为行地址和列地址，通过行选信号（RAS）和列选信号（CAS）分两次送入，大幅减少芯片封装所需要的地址引脚数量。

**2，RAS与CAS的作用与时序：**
- 1，输入：
当RAS为低电平时，表示当前输入的是行地址；
当CAS为低电平时，表示当前输入的是列地址；
- 2，基本读操作时序：
先行选发出RAS信号确定一整行，后列选发出CAS信号确定一个位置。

**DRAM刷新：**
**原因：**
DRAM使用电容存电荷，由于电容漏电，导致存储的信息会逐渐流失。为了维持数据的正确性，必须在一定的时间间隔内重新写入一次数据，
【所以刷新只用到了RAS信号，与CAS信号无关】

**三种主要刷新方式：**
- **集中刷新：**
在一个刷新周期内，集中一段时间停止所有访存，逐行刷新完。
**特征**：存在一段连续的“死时间”。
- **分散刷新：**
把刷新操作分散到每个读写周期之后，每个存取周期都被分为两部分。
**特征**：无“死时间”，但每一个存取周期都被拉长
- **异步刷新：**
将刷新周期除以行数，平均分配到各个时间段，利用CPU不访存的时间段进行刷新。

**例题：**
设DRAM存储阵列为 128行×128列，存取周期（读写时间）t_c = 0.5μs，刷新周期为 2ms。
解：
集中刷新的死时间 =  行数 * 存取周期 = 128 * 0.5 = 64us。
死时间率 = 128us/ 2ms = 3.2%
分散刷新的存取周期 = 读写时间 + 刷新时间 = 0.5 + 0.5 = 1us

# 只读存储器ROM
**特性：**
非易失性：断电后信息长期保存。

**各类ROM的原理与特点：**
- **PROM：**
通过导丝的熔断，实现一次性编程的可编程ROM。
- **Flash Memory（闪存）：**
擦除单位是块或扇区，而不是字节。写入时间远大于读取时间。
用于保存主版的BIOS程序。
- **EPROM：**
需紫外线擦除。
- **EEPROM：**
可实现多次编程。

# 存储器与CPU的连接：
## 芯片上的引脚数目：
一般芯片的引脚数目计算：
**地址线 + 数据线 + 片选线 + 读写控制线（2根）**

DRAM的地址线：
**由于采用了地址线复用技术，所需要的地址线减半**

## 存储器容量的扩展：
**1，位扩展：（增加存储字长）**
如使用2片1K * 4位存储芯片组成1K * 8位的芯片。
两片芯片分别连接高4位和低4位的数据线，两者均连接10根地址线。
![[image.png|490x279]]
**2，字扩展：（增加存储字的数量）**
例如使用2片1k * 8位的芯片组成2k * 8位的芯片。
两者均连接8根数据线，10根地址线。通过地址线A10的片选门来进行两个芯片的选择。
![[image-1.png|477x264]]
**3，字，位扩展**：
例如使用8片1k * 4位的芯片组成4k * 8位的存储器：
主要通过74138译码器来进行若干个芯片组合的选择。
![[image-2.png|491x243]]

**74138译码器介绍：**
**1，核心功能：**
将3位2进制输入，译码为8个互斥的低电平有效输出。（每次只有一个输出为0，0为有效输出）
**2，关键引脚与对应功能表：**
- A,B,C：输出引脚，C是最高位，用来决定哪一个输出有效。
- Y0# ~ Y7#：输出引脚，低电平有效。
- G1：使能端，高电平有效使能，必须接高电平，芯片才能工作。
- G2A# , G2B#：使能端，低电平有效，必须接低电平才能工作。
（MREQ#，存储器请求，低电平有效，通常连接到G2A#或G2B#上）

简而言之：
**G1端与常为1的连接，G2A,G2B与常为0的通过非门连接。**
**输出端通过非门输出**。

**实际画图的一般流程：**
**例题1：（位拓展）**
设 CPU 有 16 根地址线，8 根数据线。
      并用 MREQ（低电平有效）  作访存控制信号。WR 为写命令。现有：1K × 4位RAM， 4K × 8位，8K × 8位RAM ， 2K × 8位ROM ， 4K × 8位ROM， 8K × 8位ROM 和74LS138译码器及各种门电路。画出CPU与存储器的连接图，要求如下：
主存地址空间分配：
     6000H—67FFH为系统程序区
     6800H—6BFFH为用户程序区
![[草稿_0_1767324903894.pdf]]

**例题2：（字拓展 + 位拓展）**
**![[草稿_0_1767362035620.pdf]]**
**例题3：注意转换电平的高低的元件：**
![[草稿_0_1767368854647.pdf]]
# 存储器的校验：
## 编码的最小距离——码距：
**即任意两组合法代码之间二进制位数的最小差异。**
与编码的纠错，检错能力有关。
例如当最小距离为3时，能纠正1个错，或能检查出两个错。

## 编码纠错理论：
$$
L - 1 = D + C\ \ (D >= C)
$$
L——编码的码距；
D——检测错误的位数；
C——纠正错误的位数；
例如L = 3时，D = C = 1。

## 奇偶校验：
奇偶校验码是码距为2的编码。
**构成：**
给每一个码字加一个校验位，用它来构成奇性，偶性校验
**校验方法：**
奇性校验： = 各位之间的异或值。
偶性校验：= 各位之间的异或值取反。

## 海明码：
**是一种具有一位纠错能力的编码。**

### 海明码的组成：
**需要添加的检测位数量k：**
设原编码有n位。
$2^k >= n + k + 1$

**检测位的位置：**
放在$2^i$ (i = 0, 1, 2, .....)

**检测位的取值：**
与该位所在的检测小组所承担的奇偶校验任务有关。

**各检验小组的划分：**
**每个检验位$p_k$负责校验所有位置编号的二进制表示中第k位为1的数据位。**
例如：
p1小组负责：1，3，5，7
p2小组负责：2，3，6，7
p4小组负责：4，5，6，7
........

**例题分析：**
求0101按”偶校验“配置的海明码：
解：
已知n = 4，设增设校验位k位。
有$2^k >= n + k + 1$。所以得到：k = 3.
海明码排序如下：

| 1   | 2   | 3   | 4   | 5   | 6   | 7   |
| --- | --- | --- | --- | --- | --- | --- |
|     |     | 0   |     | 1   | 0   | 1   |
C1：负责3，5，7：得到C1 = $0 \oplus 1 \oplus 1$ = 0;
C2：负责3，6，7：得到C2 = $0 \oplus 0 \oplus 1$ = 1;
C4：负责5，6，7：得到C4 = $1 \oplus 0 \oplus 1$ = 0;
得到：

| 1   | 2   | 3   | 4   | 5   | 6   | 7   |
| --- | --- | --- | --- | --- | --- | --- |
| 0   | 1   | 0   | 0   | 1   | 0   | 1   |
得到的海明码为：0100101

### 海明码的纠错过程：
例如增添了3位检测位：
上题中：
P1 = $1 \oplus 3 \oplus 5 \oplus 7$ = ....
......
对于偶校验，不出错时，Pn均为0。
对于奇校验，不出错，即均为1。

# 高速缓冲存储器：
## 程序访问的局部性原理：
**什么是局部性原理：**
程序访问存储空间表现出的一种规律性。
- 时间局部性：某个数据被访问后，近期可能会再次被访问，
- 空间局部性：某个数据被访问后，其邻近地址的数据也可能会被访问，
**在存储系统中的应用：**
（1）cache：
- 利用时间局部性，将访问过的数据保留在cache中；
- 利用空间局部性，以数据块为单位传输。

## cache的写操作：
**1，按写时机分类：**
- 写直达：
写cache同时写主存。特点：保证一致性，但总线繁忙，延迟大。
- 写回：
写操作只更新cache，并更新脏页。仅当块被替换时，若为脏块才写回主存。
**2，按写未命中时是否调入cache分类：**
- 写分配：
未命中时，先将主存块调入cache块再写。
- 非写分配：
未命中时，直接写内存，不调入cache块。

## cache-主存系统的效率：
命中率 
$$
h = \frac{访问cache次数}{访问主存次数 + 访问cache次数} * 100%
$$
效率
$$
e = \frac{访问cache时间}{平均访问时间} * 100%
$$
平均访问时间、
$$
t = 命中率 * 访问cache时间 + (1 - 命中率) * 访问主存时间
$$

## cache-主存的地址映像：
主存与缓存按块存储，块的大小相同。

### 直接映射：
主存块放在Cache中唯一确定的位置。
$$
Cache块号 = 主存块号 \ \ mod \ \ Cache总块数
$$
**地址结构划分：**
设主存地址长度m位，cache有$2^c$块，每块$2^b$字节。
块内偏移（b位） + cache索引（c位） + 标记（m - b - c位）
优点：实现简单，查找速度快。
缺点：冲突率高，cache利用率低。
### 全相联映射：
允许主存中的每一个字块能够映射到任意一个Cache块上。
优点：冲突率低。。
缺点：实现复杂

### 组相联映射：
将cache分为Q组，每组有R块。
主存块按模映射到某一组，再在组内进行全相联映射。
**地址各段的变化：**
已知组内包括$2^r$块，则有：
- cache字段地址由c位变为q = c - r位；
- 主存字段地址由t位变为s = t + r 位。
优点：折中方案。

**例题：**
一个四路组相联的Cache共有64块，主存共有8192块，每块32个字。则主存地址中主存字
块标记为——位，组地址为——位，字块内地址为——位。
解：
主存总字数共有8192 * 32 = $2^{13}$块 * $2^5$ = $2^{18}$字
故指令长度18位。
共有64 / 4 = 16小组，组地址为4位。
字块内地址位5 + 组数（4位） = 9位。
主存字块标记为：18 - 9 - 4 = 5位。

# 提高存储器速度的措施：
- 使用高速存储的芯片
- 采用cache-主存层次结构
- 多体交叉存储
- 采用流水线访问
- 增加数据总线宽度

# 多位体交叉存储编址：
## 低位体交叉存储：
存储体数：
应该保证大于等于**单个存储体的存储周期 / 总线传输周期**
目的：保证第二次启动时，上一次的流水线内容已经全部结束。
