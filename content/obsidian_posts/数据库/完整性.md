完整性即指数据库中数据的准确性和正确性。
DBMS需要获知此类约束，并以某种方式强制实施。
基本实现方式：
拒绝任何违反约束的更新操作来保证。

取消约束：
```
DROP CONSTRAINT SC1;
```

**约束分类方案：**
- 类型约束
    类型约束是对于类型合法取值的约束
- 属性约束
    即形如：
    branch-name	 char(15),
    account-number   char(10)  not null,
- 关系变量约束
    例如：
    ```
    CONSTRAINT SC5
     IS_EMPTY (CITY = 'LONDON' AND STATUS != 20);
    ```
- 数据库约束：
    是涉及两个或多个不同关系变量的约束。
    **一般情况下，数据库约束的检查必须延迟到事务结束时进行。其他约束都是立即检查。**
    例如：
    ```
    CONSTRAINT DBC1
    IS_EMPTY ( ( S JOIN SP )
      WHERE STATUS < 20 AND QTY > 500);
    ```

# 黄金法则：
- **任何更新操作都不得使关系变量处于违反其自身谓词的状态。**  
- **任何更新事务都不得使数据库处于违反其自身谓词的状态**

# 静态约束与动态约束：
## 静态约束：
也称为状态约束，定义并关注数据库在某一个时间点下，数据必须满足的条件。
# 动态约束：
也称为过渡约束。定义数据库从一个状态转变为另一个状态的过程中，所需要遵守的规则，专注变化本身是否合法。
例如：婚姻状态：不能从未婚直接变为丧偶。

# 键：
## 候选键和超键：
设K是relvarR的一组属性。那么K是R的候选键，当且仅当满足：
- 唯一性：R的合法值中，不会出现两个不同的元组在K上有相同的值
- 不可约性：K的任何真子集都不会出现唯一性这个性质。
- 每个关系变量至少有一个候选键
- 候选键本质上是一种关系变量约束的简写形式
- 候选键的超集称为超键。

## 主键和备用键：
从候选键中选出一个主键后，其余的称为备用键。

## 外键：
形式：FOREIGN KEY (BRANCH-NAME) REFERENCES BRANCH;
**当删除外键时的操作：**
- CASCADE(级联)：删除对应引用的元组
    例如：
    ```
    create table account (. . . 
    foreign key(branch-name) references branch          
    on delete cascade 
    on update cascade. . . . )
    ```
- RESTRICT：拒绝删除
- SET NULL：置空值
- SET DEFAULT:置为默认值

## 触发器：
是在数据库发生修改时，由系统自动执行的语句。
包括的要素：
- 指定触发条件
- 指定执行动作
例如：
```
CREATE TRIGGER NEW_HIRED
  AFTER INSERT ON EMP
  FOR EACH ROW
  MODE DB2SQL
  UPDATE COMPANY_STATS SET NBEMP = NBEMP + 1
```
## 断言（assertions）:
断言是一种谓词，表达希望数据库始终满足的条件
基本格式：
```
create assertion 断言名称 check 谓词
```
例如：
```
CREATE ASSERTION IC11 CHECK ((SELECT MIN(S.STATUS) FROM S) > 4);
```
# SQL将约束分为三大类：
- 域约束
- 基表约束
- 一般约束（断言）

# 关系模型的三类完整性约束：
- 实体完整性
- 参照完整性
- 用户定义的完整性

# 候选码的求解方法：
## 属性的分类：
对于给定的关系R和函数依赖集F，课可将其属性分为：
- L类：全程只在函数依赖左边出现的属性
- R类：全程只在函数依赖右边出现的属性
- N类：两边均未出现
- LR类：在两边均有出现
## 定理一：
**若X是L类属性，则X必是R的任一候选码中的一个**。
推论：
**若X是L类属性，且X的闭包是全部属性，则X必是R的唯一候选码。**
例题：
设有关系R{A, B, C, D}。其函数依赖集为F = {D->B, B->D, AD->B, AC->D}，求R的所有候选码：
解：全程只有A,C为L类属性，而AC的闭包即为全部属性，故候选码为AC。

## 定理二：
**若X是N类属性，则X必定包含在任一候选码中。**
推论同上。

## 定理三：
**若X是R类属性，则X不在任何候选码中。**

**实例分析：**
**已知**：  
关系模式 R(A,B,C,D,E)R(A,B,C,D,E)  
函数依赖集 F={A→BC,  CD→E,  B→D,  E→A}F={A→BC,CD→E,B→D,E→A}
解：
没有L类或R类，从闭包入手：
1，先试单个的：A+ = {ABCDE}；E+ = {ABCDE}，故AE是候选码。
2，试两个的，从BCD中选择。得到BC, CD是候选码。